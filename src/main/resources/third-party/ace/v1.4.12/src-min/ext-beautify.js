define("ace/ext/beautify",["require","exports","module","ace/token_iterator"],function(e,K,t){"use strict";var L=e("../token_iterator").TokenIterator;function V(e,t){return e.type.lastIndexOf(t+".xml")>-1}K.singletonTags=["area","base","br","col","command","embed","hr","html","img","input","keygen","link","meta","param","source","track","wbr"];K.blockTags=["article","aside","blockquote","body","div","dl","fieldset","footer","form","head","header","html","nav","ol","p","script","section","style","table","tbody","tfoot","thead","ul"];K.beautify=function(e){var t=new L(e,0,0);var a=t.getCurrentToken();var r=e.getTabString();var i=K.singletonTags;var s=K.blockTags;var f;var l=false;var o=false;var n=false;var u="";var c="";var m="";var p=0;var h=0;var v=0;var d=0;var y=0;var b=0;var g=0;var $;var k=0;var w=0;var x=[];var T=false;var R;var O=false;var q=false;var C=false;var I=false;var _={0:0};var j=[];var B=function(){if(f&&f.value&&f.type!=="string.regexp")f.value=f.value.replace(/^\s*/,"")};var F=function(){u=u.replace(/ +$/,"")};var S=function(){u=u.trimRight();l=false};while(a!==null){k=t.getCurrentTokenRow();x=t.$rowTokens;f=t.stepForward();if(typeof a!=="undefined"){c=a.value;y=0;C=m==="style"||e.$modeId==="ace/mode/css";if(V(a,"tag-open")){q=true;if(f)I=s.indexOf(f.value)!==-1;if(c==="</"){if(I&&!l&&w<1)w++;if(C)w=1;y=1;I=false}}else if(V(a,"tag-close")){q=false}else if(V(a,"comment.start")){I=true}else if(V(a,"comment.end")){I=false}if(!q&&!w&&a.type==="paren.rparen"&&a.value.substr(0,1)==="}"){w++}if(k!==$){w=k;if($)w-=$}if(w){S();for(;w>0;w--)u+="\n";l=true;if(!V(a,"comment")&&!a.type.match(/^(comment|string)$/))c=c.trimLeft()}if(c){if(a.type==="keyword"&&c.match(/^(if|else|elseif|for|foreach|while|switch)$/)){j[p]=c;B();n=true;if(c.match(/^(else|elseif)$/)){if(u.match(/\}[\s]*$/)){S();o=true}}}else if(a.type==="paren.lparen"){B();if(c.substr(-1)==="{"){n=true;O=false;if(!q)w=1}if(c.substr(0,1)==="{"){o=true;if(u.substr(-1)!=="["&&u.trimRight().substr(-1)==="["){S();o=false}else if(u.trimRight().substr(-1)===")"){S()}else{F()}}}else if(a.type==="paren.rparen"){y=1;if(c.substr(0,1)==="}"){if(j[p-1]==="case")y++;if(u.trimRight().substr(-1)==="{"){S()}else{o=true;if(C)w+=2}}if(c.substr(0,1)==="]"){if(u.substr(-1)!=="}"&&u.trimRight().substr(-1)==="}"){o=false;d++;S()}}if(c.substr(0,1)===")"){if(u.substr(-1)!=="("&&u.trimRight().substr(-1)==="("){o=false;d++;S()}}F()}else if((a.type==="keyword.operator"||a.type==="keyword")&&c.match(/^(=|==|===|!=|!==|&&|\|\||and|or|xor|\+=|.=|>|>=|<|<=|=>)$/)){S();B();o=true;n=true}else if(a.type==="punctuation.operator"&&c===";"){S();B();n=true;if(C)w++}else if(a.type==="punctuation.operator"&&c.match(/^(:|,)$/)){S();B();if(c.match(/^(,)$/)&&g>0&&b===0){w++}else{n=true;l=false}}else if(a.type==="support.php_tag"&&c==="?>"&&!l){S();o=true}else if(V(a,"attribute-name")&&u.substr(-1).match(/^\s$/)){o=true}else if(V(a,"attribute-equals")){F();B()}else if(V(a,"tag-close")){F();if(c==="/>")o=true}if(l&&!(a.type.match(/^(comment)$/)&&!c.substr(0,1).match(/^[/#]$/))&&!(a.type.match(/^(string)$/)&&!c.substr(0,1).match(/^['"]$/))){d=v;if(p>h){d++;for(R=p;R>h;R--)_[R]=d}else if(p<h)d=_[p];h=p;v=d;if(y)d-=y;if(O&&!b){d++;O=false}for(R=0;R<d;R++)u+=r}if(a.type==="keyword"&&c.match(/^(case|default)$/)){j[p]=c;p++}if(a.type==="keyword"&&c.match(/^(break)$/)){if(j[p-1]&&j[p-1].match(/^(case|default)$/)){p--}}if(a.type==="paren.lparen"){b+=(c.match(/\(/g)||[]).length;g+=(c.match(/\{/g)||[]).length;p+=c.length}if(a.type==="keyword"&&c.match(/^(if|else|elseif|for|while)$/)){O=true;b=0}else if(!b&&c.trim()&&a.type!=="comment")O=false;if(a.type==="paren.rparen"){b-=(c.match(/\)/g)||[]).length;g-=(c.match(/\}/g)||[]).length;for(R=0;R<c.length;R++){p--;if(c.substr(R,1)==="}"&&j[p]==="case"){p--}}}if(a.type=="text")c=c.replace(/\s+$/," ");if(o&&!l){F();if(u.substr(-1)!=="\n")u+=" "}u+=c;if(n)u+=" ";l=false;o=false;n=false;if(V(a,"tag-close")&&(I||s.indexOf(m)!==-1)||V(a,"doctype")&&c===">"){if(I&&f&&f.value==="</")w=-1;else w=1}if(V(a,"tag-open")&&c==="</"){p--}else if(V(a,"tag-open")&&c==="<"&&i.indexOf(f.value)===-1){p++}else if(V(a,"tag-name")){m=c}else if(V(a,"tag-close")&&c==="/>"&&i.indexOf(m)===-1){p--}$=k}}a=f}u=u.trim();e.doc.setValue(u)};K.commands=[{name:"beautify",description:"Format selection (Beautify)",exec:function(e){K.beautify(e.session)},bindKey:"Ctrl-Shift-B"}]});(function(){window.require(["ace/ext/beautify"],function(e){if(typeof module=="object"&&typeof exports=="object"&&module){module.exports=e}})})();